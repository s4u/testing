name: pull_request_target

on:
  pull_request_target:
    branches:
      - 'master'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          ref: 'refs/pull/${{ github.event.number }}/merge'

      - name: show files2
        run: |
          ls -l
          cat *.txt
          git log --graph --oneline -10

      - run: echo "params ${SONARQUBE_SCANNER_PARAMS}"
        env:
          SONARQUBE_SCANNER_PARAMS: >
            {
              "sonar.pullrequest.key": "${{ github.event.number }}",
              "sonar.pullrequest.base": "${{ github.event.pull_request.base.ref }}",
              "sonar.pullrequest.branch": "${{ github.event.pull_request.head.repo.full_name }}/${{ github.event.pull_request.head.ref }}",
              "sonar.pullrequest.github.repository": "${{ github.repository }}",
              "sonar.login": "${{ secrets.TEST_SECRET }}"
            }

      - name: Test secret
        env:
          TEST_SECRET: ${{ secrets.TEST_SECRET }}
        run: |
          echo "$TEST_SECRET" | wc
          echo "$TEST_SECRET" | md5sum

      - name: Dump Env
        run: env

      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
