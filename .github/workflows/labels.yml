name: Labels sync

on:
  workflow_dispatch:

jobs:
  sync-label:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repo:
          - testing


    steps:
      - name: Sync labels on ${{ matrix.repo }}
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7
        env:
          REPO: ${{ matrix.repo }}
        with:
          github-token: ${{ github.token }}
          script: |
            
            const labels = [
              {
                name: 'bug',
                color: 'B60205',
                description: 'Something isn\'t working.'
              },
              {
                name: 'duplicate',
                color: 'cfd3d7',
                description: 'This issue or pull request already exists.'
              }
            ];
          
            const currentLabels = await github.rest.issues.listLabelsForRepo({
                owner: 's4u',
                repo: process.env.REPO
              });
            
            console.log('currentLabels:');
            console.log(currentLabels);

            console.log('labels:');
            console.log(labels);
            
            for (const label of labels) {
              const currentLabel = currentLabels.data.find(({name}) => name == label.name);

              console.log('Label: ');
              console.log(label);

              console.log('currentLabel: ');
              console.log(currentLabel);
            
              if (!currentLabel) {
  
                console.log('Add label: ' + label.name);
                github.rest.issues.createLabel({
                  owner: 's4u',
                  repo: process.env.REPO,
                  ...label
                });
  
              } else if (label.color != currentLabel.color || label.description != currentLabel.description) {
                
                console.log('Update label: ' + label.name);
                github.rest.issues.updateLabel({
                  owner: 's4u',
                  repo: process.env.REPO,
                  ...label
                });
            
              } else {
                console.log('Label: ' + label.name + ' is up to date');
              }
            }



